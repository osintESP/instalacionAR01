FASE 1)

#Sobre anfitrión

#1) Procedo a instalar vagrant

sudo pacman -S vagrant

#Observemos la versión...

vagrant version                                                                                                                                                                                                                                                                                       ✔  29s  
Installed Version: 2.3.4
Latest Version: 2.3.4

#2) Instalar VirtualBox


FASE 2)
# Instalar última versión de Manjaro GNOME con  todas sus aplicaciones actualizadas.

1) Instalar una versión de Manjaro (GNOME). 
2) Asegurar de que tengas instalado VirtualBox (o cualquier otro proveedor que desees utilizar).

  a) Montar unidad en VirtualBox
  b) sudo /run/media/osintespv1/VBox_GAs_7.0.6/VBoxLinuxAdditions.run

3) Detener la VM y exportar la caja a .box. Para hacerlo, ejecuta el siguiente comando desde la terminal

vagrant package --base nombre_de_la_VM --output nombre_de_la_caja.box
Ej: vagrant package --base manjaro-min --output osintesp.box

==> osintespv1: Exporting VM...
==> osintespv1: Compressing package to: C:osintesp.box

vagrant package --base manjaro-min --output osintesp.box

Preparar SSH

Genera un par de claves SSH (pública y privada) en tu máquina local. Puedes hacer esto ejecutando el siguiente comando en tu terminal:

ssh-keygen -t rsa

Asegúrate de no proteger la clave con una contraseña para que se puedan automatizar las conexiones SSH sin la necesidad de ingresar una contraseña.

Agrega la clave pública al archivo authorized_keys en la máquina virtual de Vagrant. Puedes hacer esto utilizando el siguiente comando en tu terminal:

cat ~/.ssh/id_rsa.pub | ssh vagrant@127.0.0.1 -p 2222 'cat >> ~/.ssh/authorized_keys'

Esto agrega la clave pública a la lista de claves permitidas para la conexión SSH.

Ahora puedes configurar Vagrant para utilizar la clave privada automáticamente. Para hacer esto, agrega el siguiente código al archivo Vagrantfile:


Vagrant.configure("2") do |config|
  config.vm.box = "osintesp/osintesp"
  config.vm.box_version = "1.0"
  config.ssh.insert_key = false
  config.ssh.private_key_path = '~/.ssh/id_rsa'
end


Esto le indica a Vagrant que no inserte la clave pública en la máquina virtual y que utilice la clave privada especificada automáticamente
para realizar la conexión SSH.

Con estos pasos, ya deberías poder conectarte a la máquina virtual sin tener que preocuparte por configurar manualmente las claves SSH. 
Simplemente ejecuta el comando vagrant up y Vagrant utilizará la clave privada especificada automáticamente para conectarse a la máquina virtual.

4) Agregar al repo  

vagrant box add osintespv1 osintespv1.box

# 5) Subi el provider al Cloud de Vagrant
vagrant cloud publish osintesp/osintesp-v1 1.0 virtualbox osintespv1.box

# Por último iniciar la VM desde Vagrant Cloud 
vagrant init osintesp/osintesp-v1 --box-version 1.0
vagrant up
