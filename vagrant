Vagrant.configure("2") do |config|
  config.vm.box = "archlinux/archlinux"
  config.vm.hostname = "Osintesp"
  config.vm.provider "virtualbox" do |vb|
    vb.memory = 4096
    vb.cpus = 2
    vb.gui = true
  end

  config.vm.provision "shell", inline: <<-SHELL
    # Install GNOME, Xorg and VirtualBox Guest Additions
    sudo pacman -Syu --noconfirm xorg xorg-xclock xorg-xauth xorg-xbacklight xorg-xev xorg-xinput xorg-xkbcomp xorg-xkbevd xorg-xkbutils xorg-xmodmap xorg-xprop xorg-xrandr xorg-xrdb xorg-xrefresh xorg-xset xorg-xsetroot xorg-xvinfo xorg-xwayland xorg-server xorg-xinit virtualbox-guest-utils-nox gnome gnome-extra

    # Check if GNOME is installed
    if ! pacman -Qs gnome-shell > /dev/null; then
      echo "GNOME not installed. Aborting..."
      exit 1
    fi

    # Configure GDM to start on boot
    sudo systemctl enable gdm.service

    # Mount the Guest Additions ISO and run the installer
    sudo mkdir /media/cdrom
    sudo mount /dev/cdrom /media/cdrom
    sudo sh /media/cdrom/VBoxLinuxAdditions.run

    # Restart VM
    sudo reboot
    sleep 60
  SHELL
end
